---
title: "Anonymous Work Part II."
author: "CoreyJackson"
date: "11/16/2018"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE}
#https://rmarkdown.rstudio.com/authoring_basics.html
# http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/ 
library(ggplot2)
library(plyr)
library(reshape2)
library(data.table)
library(readr)
library(knitr)
library(kableExtra)
library(gridExtra)
library(corrplot)
library(ggpubr)


```

```{r,  include=FALSE, warning=FALSE}
# import datasets 
geordi <- read_csv("~/Dropbox/INSPIRE/Data/System dumps/geordi-1-5-17.csv") # The raw geordi dataet

# remove unnecessary columns 
geordi <- geordi[,-c(3,8,10:17,19)]

# First logged in as indicated by first classification with a username
joindate <- ddply(geordi,"userID",summarize,
                  firstclass = min(time))
joindate <- joindate[which(joindate$userID!="(anonymous)"),]

#
# Identifying anonymous events
#

# Find unique IP/user combinations
unique_combination <- unique(geordi[c("userID", "clientIP")])
unique_combination <- unique_combination[which(unique_combination$userID != "(anonymous)"),]

unique_ips <- ddply(unique_combination, c("clientIP"), summarise,
                    userids = length(unique(userID[which(userID != '(anonymous)')]))
                    )

# get IPs only associated with one user account
unique_ips <- unique_ips[which(unique_ips$userids == 1),]
# get their ids 
unique_ips <- merge(unique_ips, unique_combination, by ="clientIP",all.x = TRUE)

# create anon/non anon datasets
geordi_anonymous <- geordi[which(geordi$userID == "(anonymous)"),] # create dataset with only anonymous
geordi_nonanonymous <- geordi[which(geordi$userID != "(anonymous)"),]
remove(geordi)
geordi_anonymous <- merge(geordi_anonymous,unique_ips, by="clientIP", all.x=TRUE) # puts userIDs next to events associated with one userID

# rename/remove columns in both datasets
names(geordi_anonymous)[4]<-"userID" # rename columns
names(geordi_anonymous)[10]<-"userID_a"
geordi_anonymous <- geordi_anonymous[,-c(9)] # remove column
geordi_nonanonymous$userID_a <- geordi_nonanonymous$userID # adds userID to columns to make datasets the same length

geordi <- rbind(geordi_anonymous,geordi_nonanonymous) #Combine anon/non anon events
remove(geordi_anonymous,geordi_nonanonymous,unique_combination) # remove unnecessary dataframes

# concatenate events data
geordi$new.categories <- paste(geordi$type, geordi$relatedID, geordi$data, sep="-")

# get unique events to determine activity
# events <- unique(geordi[c("type","new.categories","breadcrumb")]) completed this step in previous analysis and manually labeled events
events <- read_csv("~/Dropbox/INSPIRE/Papers & Presentations/Anonymous Work (Journal)/events.csv")
# remove highlevel events not needed for analysis
events <- events[which(!is.na(events$new.category)),]
# merge names of events
geordi <- merge(geordi,events, by="new.categories", all.x=TRUE)

# create the original dataset

# Combine tutorials events 
geordi$new.category[geordi$type.x %in% c("classificationStart")] <- "classify"

# Change experiment classificaions to classify
geordi$new.category[geordi$new.category %in% c("tutorial - beginner 2","tutorial - beginner 1","tutorial - no training","tutorial - beginner 3","tutorial - apprentice","tutorial - master","tutorial")] <- "tutorial"

# Keep only traces important
geordi <- geordi[which(!geordi$new.category %in% c("close-field-guide","register account","login","register account","click-favorite","link-post","logout","recent-comments-sidebar","view-talk","view-discussion","reply-post","paging")),]
# (talk-view) landing page for list of threads 
# (view-talk) viewing boards from project page. Only boards. Not sure if they clicked
# (view-discussion) viewing a single thread. Not sure where these views origniated. (use talk-N-view as proxy)
geordi_org <- geordi

# remove events that weren't important
geordi <- geordi[which(!is.na(geordi$new.category)),]

remove(unique_ips,events)
```


```{r}
# Add sesssion variable to dataframe
```

## RQ1: Exploring the dataset

### Analysis: All anonymous events that we were able to link to a user account

* Geordi traces: `r length(geordi$clientIP)` 
* Users: `r length(joindate$userID)`  
* IPs `r length(unique(geordi$clientIP))`  
* Trace type after matching:  
    + Logged-In: `r length(geordi$userID[geordi$userID != "(anonymous)"])`  
    + Identified:`r length(geordi$userID[geordi$userID == "(anonymous)" & !is.na(geordi$userID_a)])`  
    + Anonymous: `r length(geordi$userID_a[is.na(geordi$userID_a)])` 

```{r include=FALSE, warning=FALSE}
# All anonymous (linked and not linked)
geordi_all_anon <- geordi
# Anonymous traces we weren't able to link
geordi_anonymous_nolink <- geordi[which(is.na(geordi$userID_a)),] #117877 no link
# Anonymous traces we were able to link
geordi <- geordi[which(!is.na(geordi$userID_a)),] #2017383

anonymous_activities <- count(geordi_all_anon$new.category[which(geordi_all_anon$userID=="(anonymous)")])
colnames(anonymous_activities)[1] <- "event"

anonymous_activities$event <- factor(anonymous_activities$event, levels=unique(as.character(anonymous_activities$event)) )
anonymous_activities <- transform(anonymous_activities, event=reorder(event, -freq) )

allanon <- ggplot(subset(anonymous_activities, event != "classify"), aes(event, freq)) + 
  geom_bar(stat = "identity", fill="dodgerblue4") + 
  coord_flip() + 
  labs(x="Event Category",y="Frequency", title="Anon events linked and not linked") + 
  theme(
    axis.text.x=element_text(size=9),
    axis.text.y=element_text(size=9)
  )
```

```{r}
# report results from all anonymnous events
allanon
```

### Analysis: Anonymous events that we were able to link to a user account

```{r include=FALSE, warning=FALSE}
# Linked reporting using geordi dataset generated above

## Note events before a user's first loggedin classification
geordi <- merge(geordi,joindate, by.y=("userID"), by.x=("userID_a"), all.x = TRUE)
geordi$preevent <- ifelse(geordi$time < geordi$firstclass,1,0) #1 if the record is before registering

# User future contribution summary
geordi_summary <- ddply(geordi, c("userID_a"), summarize, 
                        activities = length(userID_a),
                        anonymous = length(which(userID=="(anonymous)")),
                        logged_in = length(which(!userID=="(anonymous)")),
                        first_classification = min(firstclass),
                        first_activitiy = min(time),
                        pre_reg_anon_activities = length(which(userID=="(anonymous)" & preevent ==1)),
                        post_reg_anon_activities = length(which(userID=="(anonymous)" & preevent ==0)),
                        classifications_future = length(userID_a[new.category=="classify" & preevent == 0]),
                        nonclassification_pre = length(userID_a[new.category != "classify" & preevent == 1])
                        )
geordi_summary$timepre <- geordi_summary$first_classification - geordi_summary$first_activitiy
# number will be diferent from 8606 above because some users don't actually classify. They create accounts and explore the system. 

# Analysis of the geordi_summary. How many users are anonymous/never anonymous etc. Have Akshay explore this for RQ1
```

```{r}
# Report out results from geordi analysis here
```

### Analysis: Anonymous events that we were not to link to a user account

All anonymous events for which we were able to link to a user account. There is another dataset that has `r length(geordi_anonymous_nolink$userID)` events that we weren't able to link to users.

```{r, include=FALSE, warning=FALSE}
# The anonymous activities use (geordi_anonymous_nolink) to do analysis on individual traces


```

```{r}
# Report out results from geordi_anonymous_nolink analysis here


```


### Other Behaviors

#### Analysis: Users who never classified, but explored the system. What events did they execute? 

There were `r length(joindate$userID[!(joindate$userID %in% geordi_summary$userID_a)])` users who created accounts, explored the system but never executed a classification.  

```{r include=FALSE, warning=FALSE}
nonclassusers <- joindate$userID[!(joindate$userID %in% geordi_summary$userID_a)] #304 not classifying...registered and explored
geordi_regnonclass <-  geordi_org[which(geordi_org$userID %in% nonclassusers),]
remove(nonclassusers)

#Use geordi_regnonclass to explore non-classifying volunteers. 

```

#### Analysis: Sessions with full anonyomity 
```{r}

```

### Summary of RQ1 results
Write main takeaways for RQ1

* unordered list
    + sub-item 1 
    + sub-item 2 
        - sub-sub-item 1  

*****  

## Overview of pre and post registration anonymous events
```{r, include=FALSE, warning=FALSE}
# pre-reg and post-reg anon
baregister <- geordi[which(geordi$userID=="(anonymous)"),]
regsummary <- ddply(baregister, c("new.category","preevent"), summarise,
                    count = length(new.category)
)
regsummary.cast <- dcast(regsummary, new.category~preevent)
colnames(regsummary.cast)[2] <- "Postreg"
colnames(regsummary.cast)[3] <- "Prereg"

regsummary$preevent <- factor(regsummary$preevent)
#regsummary <- na.omit(regsummary)

regsummary$new.category <- factor(regsummary$new.category, levels=unique(as.character(regsummary$new.category)) )
regsummary <- transform(regsummary, new.category=reorder(new.category, -count) ) 

anon_prepost <- ggplot(subset(regsummary, new.category != "classify"), aes(new.category,count, fill=preevent)) + 
  geom_bar(stat = "identity") + scale_fill_manual(labels = c("Pre-reg.", "Post-reg."),values = c("deepskyblue4","orangered1")) + coord_flip() +
  labs(x="Activities",y="Number of Activities") +
  guides(fill=guide_legend(title="Type")) + 
  scale_x_discrete(NULL, expand = waiver(), position = "bottom") 

## Categories of activity
prepostreg_summary <- ddply(baregister, c("new.category","preevent"), summarize,
                         users = length(unique(userID_a)),
                         count = length(userID_a)
)
  

prepostreg_summary$preevent[prepostreg_summary$preevent==0] <- "Post-reg"
prepostreg_summary$preevent[prepostreg_summary$preevent==1] <- "Pre-reg"

geordi_summarypre <- geordi_summary[which(geordi_summary$pre_reg_anon_activities !=0),]
### use geordi_summarypre (summarized) and baregister (each record) to analyze anonymous events pre-registration Code to get records is userID=="(anonymous)" & preevent ==1
pre_events <- baregister[which(baregister$userID=="(anonymous)" & baregister$preevent ==1),]
preuser_allevents <- geordi[which(geordi$userID_a %in% geordi_summarypre$userID_a),]

geordi_summarypost <- geordi_summary[which(geordi_summary$post_reg_anon_activities !=0),]
### use geordi_summarypost (summarized) and baregister (with prev) (each record) to analyze anonymous events pre-registration. Code to get is userID=="(anonymous)" & preevent ==0
post_events <- baregister[which(baregister$userID=="(anonymous)" & baregister$preevent ==0),]
postuser_allevents <- geordi[which(geordi$userID_a %in% geordi_summarypost$userID_a),]
```

```{r}
anon_prepost

kable(prepostreg_summary, "html", 
      caption = "Pre and Post registration anonymous activities", booktabs = T) %>%
kable_styling()
```

```{r include=FALSE, warning=FALSE}
#remove(anonymous_activities,anon_prepost)
```

## RQ2: Pre-registration anonymous traces
```{r include=FALSE, warning=FALSE}
# order pre-reg events for visualization
prereg_summary <- prepostreg_summary[which(prepostreg_summary$preevent == "Pre-reg"), ] 

prereg_summary$event <- factor(prereg_summary$new.category, levels=unique(as.character(prereg_summary$new.category)) )
prereg_summary <- transform(prereg_summary, new.category=reorder(new.category, -count) ) 

# Pre-registration activities
anon_prereg <- ggplot(subset(prereg_summary, new.category != "classify"), aes(new.category, count)) +
  geom_bar(stat = "identity", fill="dodgerblue4") + 
  coord_flip() + 
  labs(x="Event Category",y="Frequency") + 
  theme(
    axis.text.x=element_text(size=9),
    axis.text.y=element_text(size=9)
  )

## get pre and post anonymous users
geordi_summarypre$f <- as.Date(as.character(geordi_summarypre$first_classification), format="%Y-%m-%d")
geordi_summarypre$a <- as.Date(as.character(geordi_summarypre$first_activitiy), format="%Y-%m-%d")

geordi_summarypre$diff_in_days <- as.numeric(difftime(geordi_summarypre$f ,geordi_summarypre$a , units = c("days")))
geordi_summarypre$f <- NULL
geordi_summarypre$a <- NULL

### use geordi_summarypre (summarized), pre_events (each pre-reg. record), and preuser_allevents(all events for users who contribute pre-anonymous events)
```


```{r}
#grid.arrange(anon_prereg, anon_prereg, ncol = 2)

anon_prereg

kable(prereg_summary, "html", 
      caption = "Gravity Spy Pre-registration activities", booktabs = T) %>%
kable_styling()
```

### RQ 2 findings

* __Pre-registration traces__: There are `r length(geordi_summarypre$userID_a)` volunteers who contributed anonymously before registering for an account. On average there were `r round(mean(geordi_summarypre$pre_reg_anon_activities), digits = 2)`  and a standard deviation of `r round(sd(geordi_summarypre$pre_reg_anon_activities), digits = 2)` events, including classifying. Removing classifying events there were on average `r round(mean(geordi_summarypre$nonclassification_pre), digits = 2)` and a standard deviation of `r round(sd(geordi_summarypre$nonclassification_pre), digits = 2)` events. 

```{r include=FALSE, warning=FALSE}

```
* __Time to register when contributing anonymously__: There are `r length(which(geordi_summarypre$diff_in_days == 0))` (91%) volunteers who registered on the first day they joined the project, `r length(which(geordi_summarypre$diff_in_days > 0))` registered after this time with `r length(which(geordi_summarypre$diff_in_days == 1))` during the next day. 

```{r}
# Histogram of time to register
```


```{r include=FALSE, warning=FALSE}
pre_events_summary <- ddply(pre_events, c("userID_a"), summarize,
                            events = length(userID_a),
                            cat_types_count = length(unique(new.category))
)
geordi_summarypre <- merge(geordi_summarypre,pre_events_summary, by = "userID_a", all.x = TRUE)
remove(pre_events_summary)

geordi_summarypre.cast <- dcast(pre_events, userID_a~new.category)

```
* __Diversity of pre-registration activities__: 

```{r}
cor.test(geordi_summarypre$events, geordi_summarypre$cat_types)

```

***** 

## RQ3: Post-registration anonymous traces
```{r, include=FALSE, warning=FALSE}
# order pre-reg events for visualization
postreg_summary <- prepostreg_summary[which(prepostreg_summary$preevent == "Post-reg"), ] 
postreg_summary$event <- factor(postreg_summary$new.category, levels=unique(as.character(postreg_summary$new.category)) )
postreg_summary <- transform(postreg_summary, new.category=reorder(new.category, -count) ) 

# Post-registration activities
anon_postreg <- ggplot(subset(postreg_summary, new.category != "classify"), aes(new.category, count)) +
  geom_bar(stat = "identity", fill="dodgerblue4") + 
  coord_flip() + 
  labs(x="Event Category",y="Frequency") + 
  theme(
    axis.text.x=element_text(size=9),
    axis.text.y=element_text(size=9)
  )

geordi_summarypost$f <- as.Date(as.character(geordi_summarypost$first_classification), format="%Y-%m-%d")
geordi_summarypost$a <- as.Date(as.character(geordi_summarypost$first_activitiy), format="%Y-%m-%d")

geordi_summarypost$diff_in_days <- as.numeric(difftime(geordi_summarypost$f ,geordi_summarypost$a , units = c("days")))
geordi_summarypost$f <- NULL
geordi_summarypost$a <- NULL

### use geordi_summarypost (summarized) post_events (each post-reg. record), and postuser_allevents(all events for users who contribute post-anonymous events)

# Essentially are there behavioral differnces


```

```{r}
grid.arrange(anon_postreg, anon_postreg, ncol = 2)

kable(postreg_summary, "html", 
      caption = "Gravity Spy Pre-registration activities", booktabs = T) %>%
kable_styling()
```

### Summary of RQ3 results
Here we review the post-registration traces of volunteers who we were able to link anonymous traces to their user accounts.

* unordered list

```{r include=FALSE, warning=FALSE}
#remove(anon_postreg,postreg_summary)
```

*****

## RQ4: Participation intention
```{r, include=FALSE, warning=FALSE}
# Use dataset with session information.
geordi2 <- read_csv("~/Dropbox/INSPIRE/Papers & Presentations/Anonymous Work (Journal)/Data/Session/geordi-session-added.csv")
colnames(geordi2)[22] <- "Sequence"
geordi2[c(1,2,4,6,9,11:14,18:20)] <- NULL

# relationship between pre-registration and future contribution intention. Look at classification only, all, non-classifications

### NEED TO ADD OTHER TRACES EVEN THOUGH NOT IN PRE-REG.
geordi2_summary <- ddply(geordi2, c("userID_a","Session"), summarize,
                         task = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide") & userID != "(anonymous)")),
                         viewing = length(which(new.category %in% c(
                           "talk-bugs-view","talk-chat-view", "talk-help-view", "talk-science-view","talk-notes-view",
                           "talk-view","talk-newglitches-view","talk-collections-view")  
                            & userID != "(anonymous)")),
                         socialize = length(which(new.category %in% c(
                           "post-comment","edit-post","delete-post","private-message","update-comment")
                           & userID != "(anonymous)")),
                         learn = length(which(new.category %in% c(
                           "tutorial", "mini-course") & userID != "(anonymous)")),
                          community = length(which(new.category %in% c(
                           "view-profile-author","gs-about","gs-collections","view-profile-author","gs-favorites",
                           "keyword-search","hashtag-sidebar")  
                           & userID != "(anonymous)")),
                          impressions = length(which(new.category %in% c(
                           "like-post", "unfavorite", "report-post","subscribe")  
                           & userID != "(anonymous)")),
                         classifications = length(which(new.category %in% c("classify")  
                                                        & userID != "(anonymous)")),
                          anontask = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide") 
                           & userID == "(anonymous)")),
                         anonviewing = length(which(new.category %in% c(
                           "talk-bugs-view","talk-chat-view", "talk-help-view", "talk-science-view","talk-notes-view",
                           "talk-view","talk-newglitches-view","talk-collections-view")  
                            & userID == "(anonymous)")),
                         anonsocialize = length(which(new.category %in% c(
                           "post-comment","edit-post","delete-post","private-message","update-comment")
                           & userID == "(anonymous)")),
                         anonlearn = length(which(new.category %in% c(
                           "tutorial", "mini-course") 
                           & userID == "(anonymous)")),
                          anoncommunity = length(which(new.category %in% c(
                           "view-profile-author","gs-about","gs-collections","view-profile-author","gs-favorites",
                           "keyword-search","hashtag-sidebar")  
                           & userID == "(anonymous)")),
                         anonimpressions = length(which(new.category %in% c(
                           "like-post", "unfavorite", "report-post","subscribe")  
                           & userID == "(anonymous)")),
                         anonclassifications = length(which(new.category %in% c("classify") & userID == "(anonymous)")),
                         total_classifications = length(which(new.category %in% c("classify")))
                         )

geordi2_summary$anontype <- as.factor(ifelse(geordi2_summary$anonviewing > 0 | geordi2_summary$anonsocialize > 0 |
                                      geordi2_summary$anonlearn > 0 | geordi2_summary$anoncommunity > 0 |
                                      geordi2_summary$anonimpressions > 0 | geordi2_summary$anonclassifications > 0
                                      ,1,0))

geordi2_summary$anoninteraction <- geordi2_summary$anonviewing+geordi2_summary$anonsocialize+
                                 geordi2_summary$anonlearn+geordi2_summary$anoncommunity+
                                 geordi2_summary$anonimpressions

geordi2_summary$identifiedinteraction <- geordi2_summary$viewing+geordi2_summary$socialize+
                                 geordi2_summary$learn+geordi2_summary$community+
                                 geordi2_summary$impressions

geordi2_summary$totalinteraction <- geordi2_summary$identifiedinteraction + geordi2_summary$anoninteraction


geordi2_summary$tasktype <- as.factor(ifelse(geordi2_summary$anontask > 0 | geordi2_summary$task > 0,1,0))
geordi2_summary$viewingtype <- as.factor(ifelse(geordi2_summary$anonviewing > 0 | geordi2_summary$viewing > 0,1,0))
geordi2_summary$socialzingtype <- as.factor(ifelse(geordi2_summary$anonsocialize > 0 | geordi2_summary$socialize > 0,1,0))
geordi2_summary$learntype <- as.factor(ifelse(geordi2_summary$anonlearn > 0 | geordi2_summary$learn > 0,1,0))
geordi2_summary$communitytype <- as.factor(ifelse(geordi2_summary$anoncommunity > 0 | geordi2_summary$community > 0,1,0))
geordi2_summary$impressiontype <- as.factor(ifelse(geordi2_summary$anonimpressions > 0 | geordi2_summary$impressions > 0,1,0))
geordi2_summary$classifyingtype <- as.factor(ifelse(geordi2_summary$anonclassifications > 0 | geordi2_summary$classifications > 0,1,0))

# First session
geordi2_summary_first <- geordi2_summary[which(geordi2_summary$Session ==1),]
```

```{r, include=FALSE, warning=FALSE}
# Still around after session 1,2,3  by anonymous contributor status

anonuserlist <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==1)]
nonanonuserlist <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==0)]

tasklist.a <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==1 & geordi2_summary_first$tasktype == 1)]
tasklist.n <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==0 & geordi2_summary_first$tasktype == 1)]
community.a <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==1 & geordi2_summary_first$communitytype == 1)]
community.n <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==0 & geordi2_summary_first$communitytype == 1)]
view.a <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==1 & geordi2_summary_first$viewingtype == 1)]
view.n <- geordi2_summary_first$userID_a[which(geordi2_summary_first$anontype ==0 & geordi2_summary_first$viewingtype == 1)]

# Get activities of above users and summarize by session
geordi2_lateranon <- geordi2[which(geordi2$userID_a %in% anonuserlist & geordi2$Session >1),]
geordi2_laternonanon <- geordi2[which(geordi2$userID_a %in% nonanonuserlist & geordi2$Session >1),]

geordi2_summary_anon <- ddply(geordi2_lateranon, c("Session"), summarize,
                         users = length(unique(userID_a)),
                         proportion = users/length(anonuserlist),
                         task = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide"))),
                         viewing = length(which(new.category %in% c(
                           "talk-bugs-view","talk-chat-view", "talk-help-view", "talk-science-view","talk-notes-view",
                           "talk-view","talk-newglitches-view","talk-collections-view"))),
                         socialize = length(which(new.category %in% c(
                           "post-comment","edit-post","delete-post","private-message","update-comment"))),
                         learn = length(which(new.category %in% c("tutorial", "mini-course"))),
                          community = length(which(new.category %in% c(
                           "view-profile-author","gs-about","gs-collections","view-profile-author","gs-favorites",
                           "keyword-search","hashtag-sidebar"))),
                          impressions = length(which(new.category %in% c(
                           "like-post", "unfavorite", "report-post","subscribe"))),
                         classifications = length(which(new.category %in% c("classify"))),
                          anontask = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide")))
                         )
geordi2_summary_anon$Anon.Type <- "Anon Contributor"

geordi2_summary_nonanon <- ddply(geordi2_laternonanon, c("Session"), summarize,
                         users = length(unique(userID_a)),
                         proportion = users/length(nonanonuserlist),
                         task = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide"))),
                         viewing = length(which(new.category %in% c(
                           "talk-bugs-view","talk-chat-view", "talk-help-view", "talk-science-view","talk-notes-view",
                           "talk-view","talk-newglitches-view","talk-collections-view"))),
                         socialize = length(which(new.category %in% c(
                           "post-comment","edit-post","delete-post","private-message","update-comment"))),
                         learn = length(which(new.category %in% c("tutorial", "mini-course"))),
                          community = length(which(new.category %in% c(
                           "view-profile-author","gs-about","gs-collections","view-profile-author","gs-favorites",
                           "keyword-search","hashtag-sidebar"))),
                          impressions = length(which(new.category %in% c(
                           "like-post", "unfavorite", "report-post","subscribe"))),
                         classifications = length(which(new.category %in% c("classify"))),
                          anontask = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide")))
                         )
geordi2_summary_nonanon$Anon.Type <- "Non-Anon Contributor"
geordi2_summary_future <- rbind(geordi2_summary_nonanon,geordi2_summary_anon)

### Get data by user
geordi2_user_summary_anon <- ddply(geordi2_lateranon, c("userID_a"), summarize,
                         tenure_begin = min(time),
                         tenure_end = max(time),
                          task = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide"))),
                         viewing = length(which(new.category %in% c(
                           "talk-bugs-view","talk-chat-view", "talk-help-view", "talk-science-view","talk-notes-view",
                           "talk-view","talk-newglitches-view","talk-collections-view"))),
                         socialize = length(which(new.category %in% c(
                           "post-comment","edit-post","delete-post","private-message","update-comment"))),
                         learn = length(which(new.category %in% c("tutorial", "mini-course"))),
                          community = length(which(new.category %in% c(
                           "view-profile-author","gs-about","gs-collections","view-profile-author","gs-favorites",
                           "keyword-search","hashtag-sidebar"))),
                          impressions = length(which(new.category %in% c(
                           "like-post", "unfavorite", "report-post","subscribe"))),
                         classifications = length(which(new.category %in% c("classify"))),
                          anontask = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide")))
                         )
geordi2_user_summary_anon$Anon.Type <- "Anon Contributor"
geordi2_user_summary_anon$Task.Type <- ifelse(geordi2_user_summary_anon$userID_a %in% tasklist.a,"Task","No Task")
geordi2_user_summary_anon$Community.Type <- ifelse(geordi2_user_summary_anon$userID_a %in% community.a,"Community","No Community")
geordi2_user_summary_anon$Viewing.Type <-  ifelse(geordi2_user_summary_anon$userID_a %in% view.a,"Viewing","No Viewing")

geordi2_user_summary_nonanon <- ddply(geordi2_laternonanon, c("userID_a"), summarize,
                        tenure_begin = min(time),
                         tenure_end = max(time),
                         task = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide"))),
                         viewing = length(which(new.category %in% c(
                           "talk-bugs-view","talk-chat-view", "talk-help-view", "talk-science-view","talk-notes-view",
                           "talk-view","talk-newglitches-view","talk-collections-view"))),
                         socialize = length(which(new.category %in% c(
                           "post-comment","edit-post","delete-post","private-message","update-comment"))),
                         learn = length(which(new.category %in% c("tutorial", "mini-course"))),
                          community = length(which(new.category %in% c(
                           "view-profile-author","gs-about","gs-collections","view-profile-author","gs-favorites",
                           "keyword-search","hashtag-sidebar"))),
                          impressions = length(which(new.category %in% c(
                           "like-post", "unfavorite", "report-post","subscribe"))),
                         classifications = length(which(new.category %in% c("classify"))),
                          anontask = length(which(new.category %in% c(
                           "examine-image","image metadata","open-field-guide")))
                         )

geordi2_user_summary_nonanon$Anon.Type <- "Non-Anon Contributor"
geordi2_user_summary_nonanon$Task.Type <- ifelse(geordi2_user_summary_nonanon$userID_a %in% tasklist.n,"Task","No Task")
geordi2_user_summary_nonanon$Community.Type <- ifelse(geordi2_user_summary_nonanon$userID_a %in% community.n,"Community","No Community")
geordi2_user_summary_nonanon$Viewing.Type <-  ifelse(geordi2_user_summary_nonanon$userID_a %in% view.n,"Viewing","No Viewing")
geordi2_user_summary_future <- rbind(geordi2_user_summary_nonanon,geordi2_user_summary_anon)

remove(geordi2_summary_nonanon,geordi2_laternonanon,nonanonuserlist,geordi2_summary_anon,geordi2_lateranon,anonuserlist,geordi2_user_summary_nonanon,geordi2_user_summary_anon)
```

```{r }
# Still contributing
ggline(subset(geordi2_summary_future, Session <= 10), x = "Session", y = "proportion", 
        #add = c("mean_se", "jitter"),
        ylab = "Proportion of Volunteers",
        color = "Anon.Type", palette = "jco")

# boxplot of future classifications
geordi2_user_summary_future$classifications.log <- log(geordi2_user_summary_future$classifications)
geordi2_user_summary_future$classifications.log[geordi2_user_summary_future$classifications.log < 1] <- 0

my_comparisons <- list( c("Non-Anon Contributor", "Anon Contributor"))
ggerrorplot(geordi2_user_summary_future, x = "Anon.Type", y = "classifications.log",
            desc_stat = "mean", color = "Anon.Type", 
            add="dotplot", palette = "jco",
            add.params = list(binwidth = 0.1, dotsize = 0.5)
            )+ 
  stat_compare_means(comparisons = my_comparisons)+ # Add pairwise comparisons p-value
  stat_compare_means(label.y = 15) 

# Compare task
geordi2_user_summary_future$task.log <- log(geordi2_user_summary_future$task)
geordi2_user_summary_future$task.log[geordi2_user_summary_future$task.log < 1] <- 0

my_comparisons.task <- list( c("Non-Anon Contributor", "Anon Contributor"),c("Task","No Task"))
a <- ggerrorplot(geordi2_user_summary_future, x = "Task.Type", y = "task.log",
            desc_stat = "mean_sd", color = "Anon.Type",
            add="dotplot", palette = "jco", ylab = "Future Task (log)",
            xlab = "Task in Session 1",
            add.params = list(binwidth = 0.1, dotsize = 0.5))
a + stat_compare_means(comparisons = my_comparisons.task, label.y = c(29, 35, 40))+
  stat_compare_means(label.y = 45)

# Compare viewing
geordi2_user_summary_future$view.log <- log(geordi2_user_summary_future$viewing)
geordi2_user_summary_future$view.log[geordi2_user_summary_future$view.log < 1] <- 0

p <- ggerrorplot(geordi2_user_summary_future, x = "Viewing.Type", y = "view.log",
            desc_stat = "mean_sd", color = "Anon.Type",
            add="dotplot", palette = "jco", ylab = "Future Viewing (log)",
            xlab = "Viewing in Session 1",
            add.params = list(binwidth = 0.1, dotsize = 0.9))
p + stat_compare_means(label = "p.format")
           

# Compare community
geordi2_user_summary_future$community.log <- log(geordi2_user_summary_future$community)
geordi2_user_summary_future$community.log[geordi2_user_summary_future$community.log < 1] <- 0

m <- ggerrorplot(geordi2_user_summary_future, x = "Community.Type", y = "community.log",
            desc_stat = "mean_sd", color = "Community.Type",
            add="dotplot", palette = "jco", ylab = "Future Community (log)",
            xlab = "Community in Session 1",facet.by = "Anon.Type",
            add.params = list(binwidth = 0.1, dotsize = 0.9))
m + stat_compare_means(label = "p.format")

```


```{r }
# Comparing for those who contribute anonymously (task,social, and project) (type = 1) whether they do more/less classifying than those who logged-in sessions (0)

## does anonymous contribution lead to more classifications
tapply(geordi2_summary_first$total_classifications,geordi2_summary_first$anontype, FUN = median)
 wilcox.test(geordi2_summary_first$total_classifications~geordi2_summary_first$anontype)
## users who contribute anonymously do more classifications in their first session (are they more involved in other interactions?)
tapply(geordi2_summary_first$totalinteraction,geordi2_summary_first$anontype, FUN = mean)
wilcox.test(geordi2_summary_first$totalinteraction~geordi2_summary_first$anontype) # contribute same amount of interactions but sig. (strange)

### TASK
task <- geordi2_summary[which(geordi2_summary$tasktype =="1"),]
# More Classifying
tapply(task$total_classifications,task$anontype, FUN = mean)
wilcox.test(task$total_classifications~task$anontype)
# More Task
tapply(task$task,task$anontype, FUN = mean)
wilcox.test(task$task~task$anontype)
remove(task)

### VIEWING
viewing <- geordi2_summary[which(geordi2_summary$viewingtype =="1"),]
# More Classifying
tapply(viewing$total_classifications,viewing$anontype, FUN = median)
wilcox.test(viewing$total_classifications~viewing$anontype)
# More Viewing
tapply(viewing$viewing,viewing$anontype, FUN = median)
wilcox.test(viewing$viewing~viewing$anontype)
remove(viewing)

### Community
community <- geordi2_summary[which(geordi2_summary$communitytype =="1"),]
# More Classifying
tapply(community$total_classifications,community$anontype, FUN = median)
wilcox.test(community$total_classifications~community$anontype)
# More Community
tapply(community$community,community$anontype, FUN = median)
wilcox.test(community$community~community$anontype)
remove(community)
```

### Summary of RQ4 results

* unordered list
    + sub-item 1 
    + sub-item 2 
        - sub-sub-item 1  
        
        

*****

## RQ5. Participation around signing in for known volunteers
```{r, include=FALSE, warning=FALSE}
# Sessions after having an account
geordi2_summary_post <- geordi2_summary[which(geordi2_summary$Session > 1 & geordi2_summary$anontype == "1"),]
geordi2_summary_post$Session <- as.factor(geordi2_summary_post$Session)

#There are 335 unique volunteers and 864 sessions
```

```{r}

```


### Summary of RQ5 results

* unordered list
    + sub-item 1 
    + sub-item 2 
        - sub-sub-item 1  
        

